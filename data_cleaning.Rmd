---
title: "data_cleaning"
author: "Guangze Yu"
date: "2/6/2022"
output: html_document
---

```{r}
library(tidyverse)
library(tidyr)
library(ggplot2)
disease <- read.csv("Downloads/Disease Severity and Meaning Making in SLOS_February 1, 2022_16.39.csv", header=TRUE,na.strings=c("","NA"))
disease = disease[-1:-2,]

disease <- disease %>% select(-StartDate,-EndDate,-Status,-IPAddress,-Duration..in.seconds.,-RecordedDate,-ResponseId,-RecipientFirstName,-RecipientEmail,-RecipientLastName,-ExternalReference,-LocationLatitude,-LocationLongitude,-DistributionChannel,-UserLanguage,-Q_RecaptchaScore) %>% mutate(id=row_number())

# Remove rows: process < 10 & severity_score =0
anormal_data <- disease %>% 
  filter(as.numeric(as.character(Progress)) < 10 & as.numeric(as.character(SC0))==0)
# Subset for text-only dataset (Q33,34,35 find the meaning related)
meaning <- disease %>% select(Q33,Q34,Q35)
# The subset after remove anomal rows based on process and severity_score
normal_data <- disease %>% filter(!id %in% anormal_data$id) %>% as.data.frame()

# manually change the all age with unit year. 
normal_data$Q8 = as.character(normal_data$Q8)
normal_data[7, 16] = 2.5
normal_data[72,16] = 0.75
normal_data[70,16] = 3.92
normal_data[64,16] = 3.17
normal_data[8,16] = 0.92
normal_data[74,16] = 1.5
normal_data[54,16] = 26

#Convert severity score to 100-point scale.
normal_data <- normal_data %>% mutate(SC100 = as.numeric(SC0)/20*100) 

#Calculate QOL.
QOL <- function(x){
  x <-  
    ifelse(x==1,100,ifelse(x==2,75,ifelse(x==3,50,ifelse(x==4,25,ifelse(x==5,0," ")))))
}
normal_data[,36:58] <- QOL(normal_data[,36:58])

normal_data[,36:58] <- apply(normal_data[,36:58],2,function(x) as.numeric(x))

normal_data$QOL <- apply(normal_data[,36:58], 1, mean, na.rm = TRUE)
####### whether we should exclude 18 
normal_data <- normal_data %>% filter(as.numeric(Q8) <18)

length(is.null(normal_data$Q28_2))


library(dplyr)

normal_data <- normal_data %>% rowwise() %>% mutate(missing_detectQOL=sum(is.na(c_across(Q28_1:Q31_5))))

# more than 50% should not be counted 
# if missing_detectQOL > 23/2, this row don't hava life-quality score. 
table(normal_data$missing_detectQOL)
table(normal_data$Q8)



```

